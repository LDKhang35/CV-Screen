<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Sàng lọc CV</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='image/logo.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .scroll-area {
            max-height: 120px;
            overflow-y: auto;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 5px 10px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .file-item span {
            flex-grow: 1;
            word-break: break-word;
        }
        .file-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="mb-4">Sàng lọc CV ứng viên</h2>

    <form id="cvForm" action="{{ url_for('main.screen_cv') }}" method="POST" enctype="multipart/form-data" class="border p-4 bg-white shadow-sm rounded">

        <!-- CV Upload Area -->
        <div class="mb-4">
            <label class="form-label">Kéo & Thả CV hoặc Chọn File (.pdf, .docx)</label>
            <div id="drop-area" class="border border-primary rounded p-4 text-center bg-light" style="cursor: pointer;">
                <p>Kéo & thả hoặc bấm để chọn nhiều CV</p>
                <input type="file" id="cvInput" name="cv_files" multiple accept=".pdf,.doc,.docx" hidden>
            </div>

            <div class="file-list mt-3" id="fileList"></div>
        </div>

        <!-- Tabs for JD -->
        <ul class="nav nav-tabs mb-3" id="jdTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual" type="button" role="tab">Nhập JD thủ công</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file" type="button" role="tab">Tải JD từ file</button>
            </li>
        </ul>

        <div class="tab-content" id="jdTabsContent">
            <!-- Manual Input Tab -->
            <div class="tab-pane fade show active" id="manual" role="tabpanel">
                <div class="mb-3">
                    <label class="form-label">Vị trí tuyển dụng</label>
                    <input type="text" class="form-control" name="job_title">
                </div>

                <div class="mb-3">
                    <label class="form-label">Nội dung công việc</label>
                    <textarea class="form-control scroll-area" name="description" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Yêu cầu</label>
                    <textarea class="form-control scroll-area" name="requirements" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Quyền lợi</label>
                    <textarea class="form-control scroll-area" name="benefits" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Thông tin khác</label>
                    <textarea class="form-control scroll-area" name="other" rows="3"></textarea>
                </div>
            </div>

            <!-- File Upload Tab -->
            <div class="tab-pane fade" id="file" role="tabpanel">
                <div class="mb-3">
                    <label class="form-label">Tải lên JD (.txt hoặc .docx)</label>
                    <input type="file" class="form-control" name="jd_file" accept=".txt,.doc,.docx">
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-end mt-4">
            <button type="reset" class="btn btn-secondary me-2">Làm mới</button>
            <button type="submit" class="btn btn-primary">Sàng lọc</button>
        </div>
        <div id="loadingSpinner" class="text-center mt-3" style="display: none;">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">Đang sàng lọc, vui lòng chờ...</p>
        </div>
    </form>
</div>

<script>
    const dropArea = document.getElementById("drop-area");
    const cvInput = document.getElementById("cvInput");
    const fileList = document.getElementById("fileList");

    dropArea.addEventListener("click", () => cvInput.click());

    dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("bg-info", "text-white");
    });

    dropArea.addEventListener("dragleave", () => {
        dropArea.classList.remove("bg-info", "text-white");
    });

    dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        dropArea.classList.remove("bg-info", "text-white");

        const files = Array.from(e.dataTransfer.files);
        for (let file of files) {
            addFileItem(file);
        }

        const dataTransfer = new DataTransfer();
        [...fileList.children].forEach(item => dataTransfer.items.add(item.file));
        cvInput.files = dataTransfer.files;
    });

    cvInput.addEventListener("change", () => {
        fileList.innerHTML = "";
        const files = Array.from(cvInput.files);
        files.forEach(file => addFileItem(file));
    });

    function addFileItem(file) {
        const item = document.createElement("div");
        item.className = "file-item";
        item.file = file;

        const nameSpan = document.createElement("span");
        nameSpan.textContent = file.name;

        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.className = "btn btn-sm btn-danger ms-2";
        removeBtn.innerHTML = "&times;";
        removeBtn.onclick = () => {
            item.remove();
            const dataTransfer = new DataTransfer();
            [...fileList.children].forEach(child => {
                if (child !== item) dataTransfer.items.add(child.file);
            });
            cvInput.files = dataTransfer.files;
        };

        item.appendChild(nameSpan);
        item.appendChild(removeBtn);
        fileList.appendChild(item);
    }
    const form = document.querySelector('form');
    const spinner = document.getElementById('loadingSpinner');

    form.addEventListener('submit', function () {
        spinner.style.display = 'block';
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
